"use strict";function getDateStr(t){var a=t.getFullYear(),e=t.getMonth()+1;e=10>e?"0"+e:e;var n=t.getDate();return n=10>n?"0"+n:n,a+"-"+e+"-"+n}function randomBuildData(t){for(var a={},e=new Date("2016-01-01"),n="",r=1;92>r;r++)n=getDateStr(e),a[n]=Math.ceil(Math.random()*t),e.setDate(e.getDate()+1);return a}function renderChart(){var t=document.getElementsByClassName("aqi-chart-wrap")[0],a=pageState.nowSelectCity,e=pageState.nowGraTime,n=aqiSourceData[a],r=0,i=[],o=0,l=0;if(t.innerHTML="",chartData[a]||(chartData[a]={}),!chartData[a][e]){chartData[a][e]=[];for(var c in n)if(i.push(n[c]),r++,"week"==pageState.nowGraTime){if(r%7==0||91==r){for(var d=0;d<i.length;d++)o+=i[d];o/=i.length,chartData[a][e].push(Math.round(o)),i=[],o=0}}else if("month"==pageState.nowGraTime&&1!=r&&("01"==c.split("-")[c.split("-").length-1]||91==r)){for(var h=0;h<i.length-1;h++)o+=i[h];o/=i.length-1,chartData[a][e].push(Math.round(o)),i[0]=i[i.length-1],i.length=1,o=0}"day"==pageState.nowGraTime&&(chartData[a][e]=i)}switch(pageState.nowGraTime){case"day":l=5;break;case"week":l=20;break;default:l=50}for(var u=Math.ceil(Math.max.apply(null,chartData[a][e])/100),m=0,g=chartData[a][e];m<g.length;m++){var D=document.createElement("div");D.style.width=l+"px",D.style.height=g[m]/u+"px",D.style.background=aqiColor(g[m]/u),D.style.position="absolute",D.style.bottom=0,D.style.left=(l+1)*m+"px",D.title=g[m],t.appendChild(D)}}function graTimeChange(){for(var t=document.getElementsByName("gra-time"),a=0,e=t.length;e>a;a++)t[a].checked&&(pageState.nowGraTime=t[a].value);renderChart()}function citySelectChange(){var t=document.getElementById("city-select");pageState.nowSelectCity=t.value,renderChart()}function initGraTimeForm(){for(var t=document.getElementsByName("gra-time"),a=0,e=t.length;e>a;a++)t[a].addEventListener("change",graTimeChange,!1)}function initCitySelector(){var t=document.getElementById("city-select"),a=null;for(var e in aqiSourceData)a=document.createElement("option"),a.innerHTML=e,t.appendChild(a);t.addEventListener("change",citySelectChange,!1)}function initAqiChartData(){pageState.nowSelectCity="北京",renderChart()}function aqiColor(t){var a="";return a=t>=0&&20>=t?"green":t>20&&40>=t?"blue":t>40&&60>=t?"red":t>60&&80>=t?"purple":"black"}function init(){initGraTimeForm(),initCitySelector(),initAqiChartData()}var aqiSourceData={"北京":randomBuildData(500),"上海":randomBuildData(300),"广州":randomBuildData(200),"深圳":randomBuildData(100),"成都":randomBuildData(300),"西安":randomBuildData(500),"福州":randomBuildData(100),"厦门":randomBuildData(100),"沈阳":randomBuildData(500)},chartData={},pageState={nowSelectCity:-1,nowGraTime:"day"};window.onload=function(){init()};